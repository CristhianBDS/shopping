# ==========================================
# Proyecto: shopping (Apache .htaccess ra칤z)
# ==========================================

# Aseg칰rate de tener mod_rewrite habilitado en Apache
RewriteEngine On
RewriteBase /shopping/

# ---------------------------
# 404 personalizado (p칰blico)
# ---------------------------
ErrorDocument 404 /shopping/public/404.php

# ----------------------------
# Seguridad: bloquear carpetas
# ----------------------------
# Bloquea acceso directo a /config y /inc (v칤a URL)
RewriteRule ^config/ - [F,L]
RewriteRule ^inc/ - [F,L]

# Bloquea directorios t칤picos si existieran
RewriteRule ^(vendor|node_modules)/ - [F,L]

# -----------------------------------
# 游 Blindaje extra: nunca servir PHP desde /uploads
# -----------------------------------
# Defensa en profundidad: evita ejecuci칩n o lectura de scripts
<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_URI} ^/shopping/uploads/ [NC]
  RewriteRule .*\.(php|phtml|php\d+|phar|pht)$ - [F,L]
</IfModule>

# -----------------------------------
# Seguridad: bloquear ciertos archivos
# -----------------------------------
# Archivos de entorno, backups y configuraciones sensibles
<FilesMatch "\.(env|ini|log|sql|yml|yaml|lock|bak|old|dist)$">
  Require all denied
</FilesMatch>

# Oculta .git y similares
RedirectMatch 404 /\.git
RedirectMatch 404 /\.htaccess\.bak
RedirectMatch 404 /\.DS_Store

# -----------------------------------
# Desactivar listado de directorios
# -----------------------------------
Options -Indexes

# -----------------------------------
# Caching de est치ticos (si mod_expires)
# -----------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  # Im치genes
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/png  "access plus 30 days"
  ExpiresByType image/webp "access plus 30 days"
  ExpiresByType image/gif  "access plus 30 days"
  ExpiresByType image/svg+xml "access plus 30 days"
  # CSS & JS
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType text/javascript "access plus 7 days"
  # Fuentes
  ExpiresByType font/woff2 "access plus 30 days"
  ExpiresByType font/woff  "access plus 30 days"
</IfModule>

# -----------------------------------
# Compresi칩n (si mod_deflate)
# -----------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css text/javascript application/javascript application/json
</IfModule>

# -----------------------------------
# Cabeceras b치sicas
# -----------------------------------
<IfModule mod_headers.c>
  # Evita que iFrames externos embeban tu admin (clickjacking)
  <FilesMatch "^admin/">
    Header always set X-Frame-Options "SAMEORIGIN"
  </FilesMatch>
  # Tipos MIME
  Header set X-Content-Type-Options "nosniff"
</IfModule>
